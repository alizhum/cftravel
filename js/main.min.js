
modalInit();
tabsInit();
quiz();
customSelect()


// Event listeners
document.addEventListener('DOMContentLoaded', () => {
  const header = document.querySelector('.header');
  const headerHeight = header.offsetHeight;

  window.addEventListener('scroll', () => {
      if (window.scrollY >= headerHeight) {
          header.classList.add('header--scrolled');
      } else {
          header.classList.remove('header--scrolled');
      }
  });
});

// Functions

// Modal
function modalInit() {

  const openModal = document.querySelectorAll('.open-modal');
  const modalClose = document.querySelectorAll('.modal__close');

  if( openModal ) {

    openModal.forEach(function(button) {
      button.addEventListener('click', function(e) {

        e.preventDefault();
        const modalId = button.dataset.id;
    
        const modal = document.getElementById(modalId);
        console.log(modal)
        if( modal ) {
  
          document.body.classList.add('overflow-hidden');
          modal.classList.add('modal--active');
  
        }
  
      });
    });

    document.addEventListener('click', function(e) {
      if(e.target.classList.contains('modal')) {
        const modalToClose = document.querySelector('.modal--active');
        if( modalToClose ) {
          modalToClose.classList.remove('modal--active');
        }
        if( !document.querySelector('.modal--active') ) {
          document.body.classList.remove('overflow-hidden');
        }
      }
    });
  
  }
  
  if( modalClose ) {
  
    modalClose.forEach(function(button) {
      button.addEventListener('click', function() {
        this.closest('.modal').classList.remove('modal--active');
        if( !document.querySelector('.modal--active') ) {
          document.body.classList.remove('overflow-hidden');
        }
      });
    });
  
  }

}

// Tabs
function tabsInit() {
  const tabButtons = document.querySelectorAll('.tab__button');

  tabButtons.forEach(function(button) {
    button.addEventListener('click', function() {
      if (this.classList.contains('tab__button--active')) return;

      const tab = this.closest('.tab');
      const contentID = this.dataset.content;
      const activeContent = tab.querySelector('.tab__content--active');
      const activeButton = tab.querySelector('.tab__button--active');
      const contentToActivate = document.getElementById(contentID);

      if (contentToActivate) {
        if (activeContent) {
          activeContent.classList.remove('tab__content--active');
        }
        if (activeButton) {
          activeButton.classList.remove('tab__button--active');
        }

        this.classList.add('tab__button--active');
        contentToActivate.classList.add('tab__content--active');
      }
    });
  });
}

// Quiz
function quiz() {

  const calendars = document.querySelectorAll('.quiz__calendar');
  const navigation = document.querySelectorAll('.quiz__button');
  const steps = document.querySelectorAll('.quiz__step');
  let currentStep = 0;


  navigation.forEach((button) => {

    button.addEventListener('click', function() {

      if( this.classList.contains('quiz__button--prev') ) {
        navigatePrev();
      }

      if( this.classList.contains('quiz__button--next') ) {
        navigateNext();
      }


    });

  });

    function showStep(index) {
      steps.forEach(tab => tab.classList.remove('quiz__step--current'));
      steps[index].classList.add('quiz__step--current');
      scrollToTop();
    }
    

    function navigateNext() {
      if (currentStep < steps.length - 1) {
          if( validateCurrentStep() ) {
            currentStep++;
            showStep(currentStep);
            showToggleResultPrice();
          }
      }
    }

    function navigatePrev() {
        if (currentStep > 0) {
            currentStep--;
            showStep(currentStep);
            showToggleResultPrice();
        }
    }

    function validateCurrentStep() {
      const currentFields = steps[currentStep].querySelectorAll('input[required], select[required], textarea[required], input[type="checkbox"]:required, input[type="radio"]:required');
      let isValid = true;
  
      currentFields.forEach(field => {
          if (field.type === 'checkbox' || field.type === 'radio') {
              const name = field.name;
              const checked = Array.from(document.querySelectorAll(`input[name="${name}"]:checked`));
              if (checked.length === 0) {
                  isValid = false;
                  field.classList.add('invalid');
              } else {
                  field.classList.remove('invalid');
              }
          } else {
              if (!field.checkValidity()) {
                  isValid = false;
                  field.classList.add('invalid');
              } else {
                  field.classList.remove('invalid');
              }
          }
      });
  
      return isValid;
    }

    function scrollToTop() {
      const quizSection = document.querySelector('.quiz');
      if (quizSection) {
        quizSection.scrollIntoView({ behavior: 'smooth' });
      }
    }

    function showToggleResultPrice() {
      const resultPrice = document.querySelector('.quiz__result-price--mobile');
      if (resultPrice) {
        if (currentStep >= 1 && !steps[currentStep].classList.contains('quiz__step--success')) {
          resultPrice.classList.add('quiz__result-price--active');
        } else {
          resultPrice.classList.remove('quiz__result-price--active');
        }
      }
    }

    const options = {
        settings: {
          lang: 'ru',
          range: {
            disablePast: true,
          },
          selection: {
            year: false,
          },
        },
    };

    calendars?.forEach((element) => {
      const calendar = new VanillaCalendar(element, options);
      calendar.init();
    });

}


// Quantity
document.body.addEventListener('click', (event) => {
  if (event.target.classList.contains('quantity__button--decrease') || event.target.classList.contains('quantity__button--increase')) {
    const button = event.target;
    const qtyContainer = button.closest('.quantity');
    const quantityInput = qtyContainer.querySelector('.quantity__input');
    let currentValue = parseInt(quantityInput.value);

    if (button.classList.contains('quantity__button--decrease')) {
      if (currentValue > 1) {
        quantityInput.value = currentValue - 1;
      }
    }

    if (button.classList.contains('quantity__button--increase')) {
      quantityInput.value = currentValue + 1;
    }
  }
});


// Custom select
function customSelect() {
  const items = document.querySelectorAll('.select');

  if( !items ) return;

  items.forEach((item) => {

    const select = item.querySelector('select');
    const options = item.querySelectorAll('option');
    if( !options ) return;

    const current = document.createElement('div');
    current.classList.add('select__current');

    const ul = document.createElement('ul');
    ul.classList.add('select__list');

    options.forEach((option) => {
      
      const li = document.createElement('li');
      li.textContent = option.textContent;
      li.setAttribute('data-value', option.getAttribute('value'));
      li.classList.add('select__item');

      if( option.getAttribute('value') == select.value ) {
        li.classList.add('select__item--current');
        current.textContent = option.textContent;
      }
      
      ul.appendChild(li);

    });

    item.appendChild(current);
    item.appendChild(ul);

    select.addEventListener('change', function() {

      let value = !this.value ? '""' : this.value;
      let curr = ul.querySelector('li[data-value='+value+']');

      if( curr ) {

        ul.querySelector('.select__item--current').classList.remove('select__item--current');
        curr.classList.add('select__item--current');
        current.textContent = curr.textContent;
      }

      // Here is you can send data to the server
      // Here is you can send data to the server
      // Here is you can send data to the server
      // Here is you can send data to the server
      // Here is you can send data to the server
      // Here is you can send data to the server


    });

    current.addEventListener('click', function() {
      this.closest('.select').classList.toggle('select--active');
    });

    const listItems = ul.querySelectorAll('li');

    listItems.forEach((item) => {

      item.addEventListener('click', function() {
        
        if( this.classList.contains('select__item--current') ) return;

        ul.querySelector('.select__item--current').classList.remove('select__item--current');
        this.classList.add('select__item--current');
        select.value = this.dataset.value;
        current.textContent = this.textContent;

        current.closest('.select--active').classList.remove('select--active');

        select.dispatchEvent(new Event('change'));

      });

    });

    // Close dropdonw when clicked outside
    document.addEventListener('click', function(e) {
      
      if(!item.contains(e.target)) {
        item.classList.remove('select--active');
      }
    });


  });

}

// Sliders

const introSlider = new Swiper('.intro__slider', {
  slidesPerView: 'auto',
  spaceBetween: 20,
  autoplay: {
    delay: 1000,
  },
  speed: 3000,
  effect: 'fade',
  pagination: {
    el: '.card-slider-pagination',
    clickable: true
  }
});

const travelSlider = new Swiper('.travel__slider', {
  slidesPerView: 1,
  spaceBetween: 20,
  effect: 'fade',
  pagination: {
    el: '.travel__slider-pagination',
    clickable: true
  },
  navigation: {
    prevEl: '.travel__slider-nav--prev',
    nextEl: '.travel__slider-nav--next'
  },
});